<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Taser V1</title>
    <style>
        :root {
            --ox-bg: rgba(11, 16, 24, 0.9);
            --ox-surface: rgba(17, 24, 35, 0.9);
            --ox-border: rgba(117, 135, 161, 0.3);
            --ox-primary: #6ca9ff;
            --ox-success: #8fe388;
            --ox-warning: #ffd166;
            --ox-danger: #ff7d7d;
            --ox-muted: #96a8be;
            --ox-text: #ecf3ff;
        }

        * { box-sizing: border-box; user-select: none; }
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: transparent;
            font-family: Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            pointer-events: none;
        }

        .hud-wrap {
            position: fixed;
            right: 2.2vw;
            top: 50%;
            transform: translateY(-50%);
            width: 290px;
            border-radius: 14px;
            border: 1px solid var(--ox-border);
            background: linear-gradient(170deg, var(--ox-bg), rgba(8, 12, 19, 0.88));
            color: var(--ox-text);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.45);
            overflow: hidden;
            display: none;
        }

        .hud-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.72rem 0.95rem;
            border-bottom: 1px solid var(--ox-border);
        }

        .hud-title { margin: 0; font-size: 0.84rem; text-transform: uppercase; letter-spacing: 0.08em; font-weight: 700; }
        .hud-chip { font-size: 0.72rem; color: var(--ox-muted); background: rgba(255, 255, 255, 0.04); border: 1px solid var(--ox-border); padding: 0.2rem 0.5rem; border-radius: 999px; }

        .hud-body { display: grid; grid-template-columns: 68px 1fr; gap: 0.8rem; padding: 0.95rem; background: var(--ox-surface); }
        .taser-icon {
            height: 68px;
            border: 1px solid var(--ox-border);
            border-radius: 10px;
            display: grid;
            place-items: center;
            font-size: 1.8rem;
            color: var(--ox-primary);
            background: rgba(108, 169, 255, 0.08);
        }

        .status-panel { display: flex; flex-direction: column; justify-content: center; gap: 0.45rem; }
        .status-top { display: flex; justify-content: space-between; align-items: baseline; }
        .status-name { margin: 0; font-weight: 700; font-size: 0.93rem; letter-spacing: 0.03em; }
        .status-time { margin: 0; font-size: 0.76rem; color: var(--ox-muted); font-variant-numeric: tabular-nums; }

        .status-pill {
            width: fit-content;
            padding: 0.28rem 0.5rem;
            border-radius: 7px;
            border: 1px solid rgba(143, 227, 136, 0.45);
            background: rgba(143, 227, 136, 0.14);
            color: var(--ox-success);
            font-size: 0.74rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
        }

        .bar-wrap { margin-top: 0.2rem; height: 7px; border-radius: 99px; background: rgba(255, 255, 255, 0.06); overflow: hidden; }
        .bar { height: 100%; width: 100%; border-radius: inherit; background: linear-gradient(90deg, #6ca9ff, #91dd8b); transition: width 90ms linear; }

        .hud-footer { padding: 0.75rem 0.95rem; display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 0.4rem; border-top: 1px solid var(--ox-border); background: rgba(0, 0, 0, 0.12); }
        .stat { border: 1px solid var(--ox-border); border-radius: 8px; padding: 0.45rem 0.5rem; background: rgba(255, 255, 255, 0.02); text-align: center; }
        .stat-label { display: block; font-size: 0.63rem; color: var(--ox-muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.25rem; }
        .stat-value { font-size: 0.86rem; font-weight: 700; }

        .warning { color: var(--ox-warning); }
        .danger { color: var(--ox-danger); }
        .safe { color: var(--ox-success); }

        @keyframes safetyOnPulse {
            0% { transform: scale(1); text-shadow: 0 0 0 rgba(143, 227, 136, 0); }
            40% { transform: scale(1.14); text-shadow: 0 0 10px rgba(143, 227, 136, 0.8); }
            100% { transform: scale(1); text-shadow: 0 0 0 rgba(143, 227, 136, 0); }
        }

        @keyframes safetyOffPulse {
            0% { transform: scale(1); text-shadow: 0 0 0 rgba(255, 125, 125, 0); }
            40% { transform: scale(0.9); text-shadow: 0 0 10px rgba(255, 125, 125, 0.75); }
            100% { transform: scale(1); text-shadow: 0 0 0 rgba(255, 125, 125, 0); }
        }

        .safety-anim-on,
        .safety-anim-off {
            display: inline-block;
            transform-origin: center;
            will-change: transform, text-shadow;
        }

        .safety-anim-on { animation: safetyOnPulse 240ms ease-out; }
        .safety-anim-off { animation: safetyOffPulse 240ms ease-out; }
    </style>
</head>
<body>
    <section class="hud-wrap" id="hud" aria-label="Taser status">
        <header class="hud-header">
            <p class="hud-title">Taser Control</p>
            <span class="hud-chip">X26</span>
        </header>

        <div class="hud-body">
            <div class="taser-icon">âš¡</div>
            <div class="status-panel">
                <div class="status-top">
                    <p class="status-name" id="statusName">Operational</p>
                    <p class="status-time" id="statusTime">Cooldown: --</p>
                </div>
                <p class="status-pill" id="statusPill">Ready</p>
                <div class="bar-wrap"><div class="bar" id="chargeBar"></div></div>
            </div>
        </div>

        <footer class="hud-footer">
            <div class="stat"><span class="stat-label">Cartridges</span><span class="stat-value" id="cart">0 / 0</span></div>
            <div class="stat"><span class="stat-label">Charge</span><span class="stat-value warning" id="charge">0%</span></div>
            <div class="stat"><span class="stat-label">Safety</span><span class="stat-value" id="safety">Off</span></div>
        </footer>
    </section>

    <script>
        const hud = document.getElementById('hud');
        const statusName = document.getElementById('statusName');
        const statusTime = document.getElementById('statusTime');
        const statusPill = document.getElementById('statusPill');
        const chargeBar = document.getElementById('chargeBar');
        const cart = document.getElementById('cart');
        const charge = document.getElementById('charge');
        const safety = document.getElementById('safety');

        let lastSafetyOn = null;

        function setStatusTheme(status) {
            const lowered = String(status || '').toLowerCase();
            if (lowered === 'ready') {
                statusPill.style.color = 'var(--ox-success)';
                statusPill.style.borderColor = 'rgba(143,227,136,.45)';
                statusPill.style.background = 'rgba(143,227,136,.14)';
            } else if (lowered === 'safe' || lowered === 'charging') {
                statusPill.style.color = 'var(--ox-warning)';
                statusPill.style.borderColor = 'rgba(255,209,102,.45)';
                statusPill.style.background = 'rgba(255,209,102,.14)';
            } else {
                statusPill.style.color = 'var(--ox-danger)';
                statusPill.style.borderColor = 'rgba(255,125,125,.45)';
                statusPill.style.background = 'rgba(255,125,125,.14)';
            }
        }

        function playSafetyAnimation(isOn) {
            const animationClass = isOn ? 'safety-anim-on' : 'safety-anim-off';
            safety.classList.remove('safety-anim-on', 'safety-anim-off');
            // Force layout to allow replaying animation class
            void safety.offsetWidth;
            safety.classList.add(animationClass);
        }

        window.addEventListener('message', (event) => {
            const data = event.data || {};

            if (data.action === 'setVisible') {
                hud.style.display = data.visible ? 'block' : 'none';
                return;
            }

            if (data.action !== 'update') return;

            const max = Number(data.maxCartridges || 0);
            const current = Number(data.cartridges || 0);
            const pct = max > 0 ? Math.max(0, Math.min(100, Math.round((current / max) * 100))) : 0;

            statusName.textContent = data.ready ? 'Operational' : 'System Active';
            statusTime.textContent = data.showCooldown ? `Cooldown: ${data.cooldownText || '--'}` : 'Cooldown: Ready';
            statusPill.textContent = data.status || 'Ready';
            setStatusTheme(data.status);

            chargeBar.style.width = `${pct}%`;
            cart.textContent = `${current} / ${max}`;
            charge.textContent = `${pct}%`;
            charge.className = `stat-value ${pct < 30 ? 'danger' : 'warning'}`;

            const safetyOn = Boolean(data.safetyOn);
            safety.textContent = safetyOn ? 'On' : 'Off';
            safety.className = `stat-value ${safetyOn ? 'safe' : 'danger'}`;

            if (lastSafetyOn !== null && lastSafetyOn !== safetyOn) {
                playSafetyAnimation(safetyOn);
            }

            lastSafetyOn = safetyOn;
        });
    </script>
</body>
</html>
